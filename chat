{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "type": "Microsoft.DBforPostgreSQL/servers/virtualNetworkRules",
      "apiVersion": "2021-06-01",
      "name": "pg-test",
      "dependsOn": [],
      "properties": {
        "virtualNetworkSubnetId": "[parameters('subnetId')]",
        "ignoreMissingVnetServiceEndpoint": false,
        "virtualNetworkRules": []
      }
    }
  ]
}



resource "azurerm_template_deployment" "example" {
  name                = "example-deployment"
  resource_group_name = azurerm_postgresql_flexible_server.replica.resource_group_name
  deployment_mode     = "Incremental"
  template_content    = file("azuredeploy.json")

  parameters = {
    subnetId = data.azurerm_subnet.example.id
  }
}
